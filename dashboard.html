<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Access - AÂ³E | MapMyStandards.ai</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Tailwind (built) -->
    <link id="mms-tailwind" rel="stylesheet" href="./assets/styles.css">
    <script>
        (function(){
            const candidates=['./assets/styles.css','assets/styles.css','/assets/styles.css','../assets/styles.css','/public/assets/styles.css'];
            function hasTw(){
                try{const d=document.createElement('div');d.style.position='absolute';d.style.left='-9999px';d.className='text-5xl';document.documentElement.appendChild(d);const s=getComputedStyle(d).fontSize;d.remove();return s && parseFloat(s)>=48;}catch{return false;}
            }
            function tryNext(i){ if(i>=candidates.length) return; const link=document.getElementById('mms-tailwind'); if(!link) return; link.href=candidates[i]; link.onload=()=>setTimeout(()=>{ if(!hasTw()) tryNext(i+1); },0); link.onerror=()=>tryNext(i+1); }
            document.addEventListener('DOMContentLoaded', ()=>{ setTimeout(()=>{ if(!hasTw()) tryNext(0); },0); });
        })();
    </script>
    <style>body { font-family: 'Inter', sans-serif; }</style>
</head>
<body class="bg-gray-50">
    <header class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-6">
                <div class="flex items-center">
                    <img src="https://mapmystandards.ai/wp-content/uploads/2025/07/Original-Logo.png" alt="MapMyStandards.ai" class="h-12 w-auto mr-3">
                    <span class="text-xl font-bold text-gray-900">MapMyStandards.ai</span>
                </div>
                <a href="https://mapmystandards.ai/" class="text-gray-600 hover:text-gray-900">â† Back to Home</a>
            </div>
        </div>
    </header>

    <div class="min-h-screen flex items-center justify-center py-12 px-4">
        <div class="max-w-lg w-full">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-900 mb-4">ğŸ” Dashboard Access Required</h1>
                <p class="text-gray-600">Please sign in to access your AÂ³E dashboard</p>
            </div>

            <div class="bg-white rounded-2xl shadow-sm p-8 space-y-6">
                <!-- Demo Center -->
                <div class="bg-amber-50 border border-amber-200 rounded-lg p-6">
                    <h3 class="text-lg font-semibold text-amber-900 mb-2">ğŸ§ª Demo Center</h3>
                    <p class="text-sm text-amber-800 mb-3">Try the local demo without signing in. It imports a sample standard and uploads the demo evidence pack against your running API.</p>
                    <div class="flex gap-2 mb-2">
                        <input id="mms-demo-base" class="flex-1 border border-amber-300 rounded px-3 py-2 text-sm" placeholder="http://localhost:3000" />
                        <button id="mms-demo-save" class="bg-amber-600 hover:bg-amber-700 text-white text-sm font-semibold px-3 py-2 rounded">Save</button>
                    </div>
                    <div class="flex gap-2">
                        <button id="mms-run-demo" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-3 py-2 rounded">Run Local Demo</button>
                        <a class="bg-white border border-amber-300 text-amber-900 font-medium px-3 py-2 rounded" href="/examples/demo_pack/mms_demo_evidence_pack.zip">Download Pack</a>
                    </div>
                    <pre id="mms-demo-log" class="mt-3 bg-white border border-amber-200 rounded p-2 text-xs overflow-auto max-h-40"></pre>
                </div>
                <!-- Trial Access -->
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
                    <h3 class="text-lg font-semibold text-blue-900 mb-2">ğŸš€ Trial Users</h3>
                    <p class="text-sm text-blue-700 mb-4">Access your dashboard with your trial ID</p>
                    <a href="./login.html" class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-blue-700 text-center block">
                        Sign In with Trial ID
                    </a>
                </div>

                <!-- Customer Access -->
                <div class="bg-green-50 border border-green-200 rounded-lg p-6">
                    <h3 class="text-lg font-semibold text-green-900 mb-2">ğŸ’¼ Paying Customers</h3>
                    <p class="text-sm text-green-700 mb-4">Full authentication system for customer accounts</p>
                    <a href="./login.html" class="w-full bg-green-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-green-700 text-center block">
                        Customer Sign In
                    </a>
                </div>

                <!-- Quick Start -->
                <div class="bg-gray-50 border border-gray-200 rounded-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-2">ğŸ¯ New to AÂ³E?</h3>
                    <p class="text-sm text-gray-600 mb-4">Start your free 7-day trial now</p>
                    <a href="https://api.mapmystandards.ai/landing" class="w-full bg-purple-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-purple-700 text-center block">
                        Start Free Trial
                    </a>
                </div>

                <!-- Help Section -->
                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6">
                    <h3 class="text-lg font-semibold text-yellow-900 mb-2">ğŸ’¡ Need Help?</h3>
                    <div class="space-y-2 text-sm text-yellow-800">
                        <p>â€¢ <strong>Lost your trial ID?</strong> Check your signup confirmation email</p>
                        <p>â€¢ <strong>Account issues?</strong> Contact support@mapmystandards.ai</p>
                        <p>â€¢ <strong>Want a demo?</strong> <a href="https://mapmystandards.ai/contact/" class="text-yellow-600 underline">Schedule a call</a></p>
                    </div>
                </div>
            </div>

            <!-- System Status -->
            <div class="mt-6 text-center">
                <a href="https://api.mapmystandards.ai/status" target="_blank" class="text-sm text-gray-500 hover:text-gray-700">
                    ğŸŸ¢ System Status: Online
                </a>
            </div>
        </div>
    </div>

    <script>
        // Check if user is already authenticated and redirect appropriately
        document.addEventListener('DOMContentLoaded', function() {
            const trialId = localStorage.getItem('a3e_trial_id');
            const apiKey = localStorage.getItem('a3e_api_key');
            
            if (trialId) {
                // User has trial access, redirect to trial dashboard
                window.location.href = `https://api.mapmystandards.ai/dashboard/${trialId}`;
            } else if (apiKey) {
                // User has customer access, redirect to customer dashboard
                window.location.href = 'https://mapmystandards.ai/customer-dashboard/';
            }
            // Otherwise, show this authentication page
            (function() {
                const baseInput = document.getElementById('mms-demo-base');
                const saveBtn = document.getElementById('mms-demo-save');
                const runBtn = document.getElementById('mms-run-demo');
                const logEl = document.getElementById('mms-demo-log');
                if (!baseInput || !runBtn) return;

                function detectDefaultBase() {
                    const saved = localStorage.getItem('mms_demo_base');
                    if (saved) return saved;
                    if (location.hostname.endsWith('mapmystandards.ai')) {
                        return 'https://api.mapmystandards.ai';
                    }
                    return location.origin || 'http://localhost:3000';
                }
                function setBasePlaceholder() {
                    baseInput.placeholder = detectDefaultBase();
                    baseInput.value = localStorage.getItem('mms_demo_base') || '';
                }
                function log(msg, data) {
                    if (!logEl) return;
                    const time = new Date().toISOString();
                    logEl.textContent += `[${time}] ${msg}` + (data ? `\n${typeof data === 'string' ? data : JSON.stringify(data, null, 2)}` : '') + '\n\n';
                    logEl.scrollTop = logEl.scrollHeight;
                }
                async function postJson(url, payload) {
                    const res = await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                    const text = await res.text();
                    let body; try { body = JSON.parse(text); } catch { body = text; }
                    if (!res.ok) throw new Error(`HTTP ${res.status}: ${text}`);
                    return body;
                }
                async function postFile(url, blob, filename) {
                    const form = new FormData(); form.append('file', blob, filename);
                    const res = await fetch(url, { method: 'POST', body: form });
                    const text = await res.text();
                    let body; try { body = JSON.parse(text); } catch { body = text; }
                    if (!res.ok) throw new Error(`HTTP ${res.status}: ${text}`);
                    return body;
                }
                async function runDemo() {
                    const base = (baseInput.value || detectDefaultBase()).replace(/\/$/, '');
                    localStorage.setItem('mms_demo_base', base);
                    log(`Using API base: ${base}`);
                    try {
                        const std = await fetch('/examples/demo_pack/standards_SACSCOC_template.json').then(r => { if (!r.ok) throw new Error(`Failed to load standards JSON (${r.status})`); return r.json(); });
                        log('Posting to /api/standards/import ...');
                        const imp = await postJson(`${base}/api/standards/import`, std);
                        log('Standards imported:', imp);
                        const zipBlob = await fetch('/examples/demo_pack/mms_demo_evidence_pack.zip').then(r => { if (!r.ok) throw new Error(`Failed to load demo pack (${r.status})`); return r.blob(); });
                        log('Uploading demo pack to /api/upload ...');
                        const up = await postFile(`${base}/api/upload`, zipBlob, 'mms_demo_evidence_pack.zip');
                        log('Upload response:', up);
                        try { const mapRes = await fetch(`${base}/api/map`, { method: 'POST' }); log('Mapping result:', await mapRes.text()); } catch (e) { log('Map endpoint not available (continuing).'); }
                        try { const gapsRes = await fetch(`${base}/api/gaps/run`, { method: 'POST' }); log('Gap analysis result:', await gapsRes.text()); } catch (e) { log('Gaps endpoint not available (continuing).'); }
                        log('Demo finished. Open your dashboard or docs list to view results.');
                    } catch (err) { log('Demo failed:', String(err)); }
                }

                setBasePlaceholder();
                saveBtn?.addEventListener('click', () => { const val = baseInput.value || detectDefaultBase(); localStorage.setItem('mms_demo_base', val); log(`Saved API base: ${val}`); });
                runBtn.addEventListener('click', runDemo);
            })();
        });
    </script>
</body>
</html>
